<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wishplay â€¢ Login</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #e8f0ff, #ffffff);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .container {
        width: 380px;
        background: #ffffff;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        animation: fadeIn 0.7s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .logo {
        text-align: center;
        margin-bottom: 20px;
    }

    .logo img {
        width: 140px;
    }

    h2 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 600;
        color: #333;
    }

    label {
        font-weight: 500;
        margin-top: 10px;
        display: block;
    }

    input {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border-radius: 8px;
        border: 1px solid #ccc;
        transition: 0.2s;
    }

    input:focus {
        border-color: #1f75ff;
        box-shadow: 0 0 5px rgba(31,117,255,0.3);
        outline: none;
    }

    .btn {
        width: 100%;
        background: #1f75ff;
        color: white;
        padding: 12px;
        border-radius: 8px;
        border: none;
        font-size: 15px;
        margin-top: 15px;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn:hover {
        background: #1254c7;
        transform: translateY(-2px);
    }

    .google-btn {
        background: white;
        color: #444;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .google-btn:hover {
        background: #f5f5f5;
    }

    .small-text {
        text-align: center;
        margin-top: 12px;
        font-size: 14px;
    }

    .small-text a {
        color: #1f75ff;
        text-decoration: none;
    }
    .logo img {
        height: 60px;
        width: auto;
        object-fit: contain;
        display: block;
        margin: 0 auto;
    }
    .login-btn {
        width: 100%;
        background: linear-gradient(90deg, #1a73e8, #1765cc);
        border: none;
        padding: 12px 0;
        color: #fff;
        font-size: 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }

    .login-btn:hover {
        background: linear-gradient(90deg, #1765cc, #145bb8);
        transform: translateY(-2px);
        box-shadow: 0 6px 14px rgba(26, 115, 232, 0.45);
    }

    .login-btn:active {
        transform: translateY(1px);
    }


</style>

</head>
<body>

<div class="container">
    
    <!-- Wishplay Logo -->
    <div class="logo">
        <img src="assets/images/Wishplay.png" alt="Wishplay Logo">
    </div>

    <h2>Login</h2>

    <!-- Login Form -->
    <form id="loginForm">
        <label>Username or Email</label>
        <input type="text" id="username" required>

        <label>Password</label>
        <input type="password" id="password" required>

        <button type="button" class="login-btn" id="loginBtn">Login</button>


    </form>

    <!-- Google Login -->
    <button id="googleLoginBtn" class="btn google-btn">
        <img src="https://developers.google.com/identity/images/g-logo.png" width="18">
        Login with Google
    </button>

    <div class="small-text">
        Donâ€™t have an account? <a href="register.html">Register</a>
    </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyA_Y65x8uHDnuP2fxmpXLsNq9TxNZuGQLo",
    authDomain: "wishplay-7de5c.firebaseapp.com",
    projectId: "wishplay-7de5c",
    storageBucket: "wishplay-7de5c.appspot.com",
    messagingSenderId: "1025054965660",
    appId: "1:1025054965660:web:1e293b3ccfa17d97f29259",
    measurementId: "G-M2HD6ST2Y7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* -------------------------------
   GOOGLE LOGIN HANDLER (FIXED)
-------------------------------- */
document.getElementById("googleLoginBtn").addEventListener("click", () => {

    signInWithPopup(auth, provider)
        .then(async (result) => {

            const user = result.user;

            // ðŸ”¥ðŸ”¥ðŸ”¥ MOST IMPORTANT PART (YOU WERE MISSING THIS)
            localStorage.setItem("user_id", "<real_id>");
            localStorage.setItem("user_email", result.user.email);
            localStorage.setItem("user_name", result.user.displayName);




            // Optional but recommended
            localStorage.setItem("user_email", user.email);
            localStorage.setItem("user_name", user.displayName);
            localStorage.setItem("user_photo", user.photoURL);

            // Store full user in PHP session
            await fetch("backend/mysql/store_google_session.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(user)
            });

            // Proceed to backend login handler
            window.location.href = "backend/mysql/user_google_login.php";
        })
        .catch((err) => {
            console.error("Google login failed:", err);
            alert("Google login failed. Check console.");
        });
});


/* -------------------------------
   NORMAL LOGIN HANDLER
-------------------------------- */

window.loginUser = loginUser;
window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("loginBtn").addEventListener("click", loginUser);
});

async function loginUser(e) {
    e.preventDefault();

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) {
        alert("Missing fields");
        return;
    }

    try {
        const res = await fetch("http://localhost/wishplay/backend/mysql/login.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();
        console.log("LOGIN RESPONSE:", data);

        if (data.status === "success") {
            localStorage.setItem("user_id", data.user_id);
            window.location.href = "index.html";
        } else {
            alert(data.message);
        }

    } catch (error) {
        alert("Error connecting to server.");
        console.error(error);
    }
}


</script>


</body>
</html>
