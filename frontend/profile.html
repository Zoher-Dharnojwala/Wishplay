<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wishplay â€¢ Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family:"Inter",sans-serif;
    background:#f4f6fb;
    color:#333;
    transition:0.3s;
}

/* HEADER */
header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px 50px;
    background:#fff;
    border-bottom:1px solid #ddd;
}
.logo { font-size:30px; font-weight:700; cursor:pointer; }
.logo .w { color:#1ba1f2; }
.logo .i { color:#7ecf27; }
.logo .s { color:#ffc107; }
.logo .h { color:#ff4081; }
.logo .play { color:#444; }

nav ul { display:flex; gap:30px; list-style:none; }
nav ul li a { text-decoration:none; color:#333; font-weight:600; }

.theme-toggle { cursor:pointer; }

/* PROFILE LAYOUT */
.wrapper {
    display:flex;
    max-width:1200px;
    margin:40px auto;
    gap:40px;
}

/* LEFT SIDEBAR */
.sidebar {
    width:280px;
    background:#fff;
    padding:20px;
    border-radius:15px;
    box-shadow:0 4px 15px rgba(0,0,0,0.1);
}
.sidebar-item {
    padding:15px;
    font-weight:600;
    border-bottom:1px solid #eee;
    cursor:pointer;
}
.sidebar-item:hover {
    background:#e9f4ff;
}

/* PROFILE CARD */
.profile-card {
    flex:1;
    padding:30px;
    background:#fff;
    border-radius:20px;
    box-shadow:0 6px 20px rgba(0,0,0,0.1);
}

/* AVATAR */
.avatar-box {
    text-align:center;
    margin-bottom:20px;
}
.avatar-img {
    width:140px;
    height:140px;
    border-radius:50%;
    object-fit:cover;
    border:4px solid #ccc;
}
.upload-btn {
    margin-top:10px;
    cursor:pointer;
    font-size:14px;
    color:#1ba1f2;
}

/* INPUTS */
.profile-card input {
    width:100%;
    padding:12px;
    margin:10px 0;
    border-radius:10px;
    border:1px solid #ccc;
    transition:0.2s;
}
.profile-card input:focus {
    border-color:#1ba1f2;
}

/* SAVE BUTTON */
.save-btn {
    width:100%;
    padding:12px;
    background:#1ba1f2;
    color:white;
    border:none;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
}
.save-btn:hover {
    background:#1485c7;
}

/* LOGOUT MODAL */
#logout-modal{
    position:fixed; inset:0;
    display:none;
    justify-content:center;
    align-items:center;
}
#logout-modal.show { display:flex; }

.logout-backdrop{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(7px);
}
.logout-box{
    background:#fff;
    padding:30px;
    border-radius:15px;
    width:320px;
    text-align:center;
    opacity:0; transform:scale(.8);
    transition:.3s;
    z-index:10;
}
.logout-box.show{
    opacity:1; transform:scale(1);
}
.logout-btn{
    width:100%; padding:12px; margin-top:10px;
    border:none; border-radius:8px; cursor:pointer;
}
.logout-confirm{ background:#ff4f4f; color:white; }
.logout-cancel{ background:#ccc; }

.modal { 
    position: fixed; inset: 0; 
    display: none; justify-content: center; align-items: center; 
}
.modal.show { display: flex; }
.modal-backdrop {
    position: absolute; inset: 0; backdrop-filter: blur(5px);
    background: rgba(0,0,0,0.4);
}
.modal-box {
    background: #fff;
    padding: 25px;
    width: 350px;
    border-radius: 15px;
    z-index: 10;
    box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
.modal-box input {
    width: 100%; padding: 12px; margin: 8px 0;
    border-radius: 10px; border: 1px solid #ccc;
}
.modal-btn {
    width: 100%; padding: 12px; margin-top: 10px;
    border-radius: 10px; border: none;
    background: #1ba1f2; color: white; cursor: pointer;
}
.modal-btn.cancel {
    background: #ccc; color: #333;
}

.update-btn {
    width: 100%;
    background: #1a73e8;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
}

.update-btn:hover {
    background: #1664c2;
}
.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}
/* ---------------- TAB ANIMATION ---------------- */
.tab-content {
    display: none;
    opacity: 0;
    transform: translateX(10px) scale(0.98);
    transition: opacity .25s ease, transform .25s ease;
}

.tab-content.active {
    display: block;
    opacity: 1;
    transform: translateX(0) scale(1);
}
/* ---------------- iOS Bottom Sheet ---------------- */
.ios-sheet {
    position: fixed;
    left: 0; right: 0; bottom: -100%;
    background: #fff;
    border-radius: 22px 22px 0 0;
    padding: 25px;
    max-width: 500px;
    margin: 0 auto;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.15);
    transition: bottom 0.35s cubic-bezier(.25,.8,.25,1);
    z-index: 9999;
}

.ios-sheet.show {
    bottom: 0;
}

/* BACKDROP */
.ios-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(4px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .3s;
    z-index: 9998;
}

.ios-backdrop.show {
    opacity: 1;
    pointer-events: auto;
}

/* Inputs inside sheet */
.ios-sheet input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: 1px solid #ccc;
}

/* Buttons */
.sheet-btn {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    margin-top: 10px;
}

.sheet-btn.blue { background:#1a73e8; color:white; }
.sheet-btn.gray { background:#ddd; }
.sheet-btn.red { background:#ff3b30; color:white; }


</style>
</head>

<body>

<header>
    <div class="logo" onclick="location.href='index.html'">
        <span class="w">w</span><span class="i">i</span><span class="s">s</span><span class="h">h</span><span class="play">play</span>
    </div>

    <nav>
        <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="lifequestions.html">LIFE QUESTIONS</a></li>
            <li><a href="profile.html">PROFILE</a></li>
            <li><a href="#" onclick="confirmLogout()">SIGN OUT</a></li>
        </ul>
    </nav>
</header>

<div class="wrapper">

    <!-- LEFT SIDEBAR MENU -->
    <div class="sidebar">
        <div class="sidebar-item" onclick="showTab('account')">Account</div>
        <div class="sidebar-item" onclick="openSheet('sheet-password')">Change Password</div>
        <div class="sidebar-item" onclick="openSheet('sheet-privacy')">Privacy</div>
        <div class="sidebar-item" style="color:#ff4f4f;" onclick="openSheet('sheet-delete')">Delete Account</div>

    </div>


    <!-- PROFILE PANEL -->
    <div class="profile-card">

        <!-- TAB: ACCOUNT -->
        <div id="tab-account" class="tab-content active">
            <div class="avatar-box">
                <img id="avatarPreview" class="avatar-img" src="uploads/default.png">
                <br>
                <label class="upload-btn">
                    Change Photo
                    <input type="file" id="avatarUpload" accept="image/*" style="display:none">
                </label>
            </div>

            <input type="text" id="username" placeholder="Username" disabled>
            <input type="text" id="first_name" placeholder="First Name">
            <input type="text" id="last_name" placeholder="Last Name">
            <input type="email" id="email" placeholder="Email">

            <button class="update-btn">Update Account</button>
        </div>


        <!-- TAB: CHANGE PASSWORD -->
        <div id="tab-password" class="tab-content">
            <h2>Change Password</h2>
            <input type="password" id="old_pass" placeholder="Current Password">
            <input type="password" id="new_pass" placeholder="New Password">
            <input type="password" id="confirm_pass" placeholder="Confirm New Password">
            <button class="update-btn">Save Password</button>
        </div>


        <!-- TAB: PRIVACY -->
        <div id="tab-privacy" class="tab-content">
            <h2>Privacy Settings</h2>
            <label><input type="checkbox" id="show_history"> Allow AI to store my responses</label>
            <br><br>
            <button class="update-btn">Save Privacy Settings</button>
        </div>


        <!-- TAB: DELETE ACCOUNT -->
        <div id="tab-delete" class="tab-content">
            <h2 style="color:red;">Delete Account</h2>
            <p>This action is permanent and cannot be undone.</p>
            <button class="update-btn" style="background:#ff4f4f">Delete My Account</button>
        </div>

    </div>

</div>

<!-- LOGOUT MODAL -->
<div id="logout-modal">
    <div class="logout-backdrop" onclick="closeLogout()"></div>
    <div class="logout-box" id="logout-box">
        <h3>Sign Out?</h3>
        <button class="logout-btn logout-cancel" onclick="closeLogout()">Cancel</button>
        <button class="logout-btn logout-confirm" onclick="logout()">Logout</button>
    </div>
</div>

<script>

/***********************************
 FIXED PROFILE PAGE LOGIC (CLEAN)
************************************/

async function loadProfile() {

    const res = await fetch("backend/mysql/api_profile_get.php");
    const data = await res.json();

    console.log("PROFILE DATA:", data);

    if (data.status !== "success") {
        alert("Could not load profile. Please log in.");
        window.location.href = "login.html";
        return;
    }

    const u = data.user;

    document.getElementById("username").value    = u.username || "";
    document.getElementById("first_name").value = u.first_name || "";
    document.getElementById("last_name").value  = u.last_name || "";
    document.getElementById("email").value      = u.email || "";

    if (u.photo) {
        document.getElementById("avatarPreview").src = u.photo;
    }
}

// Call on page load
document.addEventListener("DOMContentLoaded", loadProfile);



/***********************************
 UPDATE PROFILE
************************************/
async function updateProfile() {

    const payload = {
        username: document.getElementById("username").value,
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        email: document.getElementById("email").value
    };

    const res = await fetch("backend/mysql/api_profile_update.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.status === "success") {
        alert("Profile updated successfully!");
        loadProfile();
    } else {
        alert(data.message);
    }
}

document.querySelector(".update-btn").addEventListener("click", updateProfile);



/***********************************
 PHOTO UPLOAD
************************************/
document.getElementById("avatarUpload").addEventListener("change", async function () {
    const file = this.files[0];
    if (!file) return;

    let fd = new FormData();
    fd.append("photo", file);

    const res = await fetch("backend/mysql/upload_profile_photo.php", {
        method: "POST",
        body: fd
    });

    const data = await res.json();

    if (data.status === "success") {
        document.getElementById("avatarPreview").src = data.path + "?v=" + Date.now();
        alert("Photo updated!");
    } else {
        alert("Photo upload failed: " + data.message);
    }
});



</script>
<!-- CHANGE PASSWORD MODAL -->
<div id="password-modal" class="modal hidden">
  <div class="modal-backdrop" onclick="closePasswordModal()"></div>
  <div class="modal-box">
      <h3>Change Password</h3>

      <input type="password" id="old_pass" placeholder="Current Password">
      <input type="password" id="new_pass" placeholder="New Password">
      <input type="password" id="confirm_pass" placeholder="Confirm New Password">

      <button class="modal-btn" onclick="updatePassword()">Update Password</button>
      <button class="modal-btn cancel" onclick="closePasswordModal()">Cancel</button>
  </div>
</div>
<!-- DELETE ACCOUNT MODAL -->
<div id="delete-modal" class="modal hidden">
  <div class="modal-backdrop" onclick="closeDeleteModal()"></div>
  <div class="modal-box">
      <h3 style="color:#ff4f4f">Delete Account?</h3>
      <p>This action cannot be undone.</p>

      <button class="modal-btn" style="background:#ff4f4f" onclick="deleteAccount()">Delete</button>
      <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancel</button>
  </div>
</div>
<div class="sidebar-item" onclick="openPrivacy()">Privacy</div>
<div id="privacy-modal" class="modal hidden">
  <div class="modal-backdrop" onclick="closePrivacy()"></div>
  <div class="modal-box">
    <h3>Privacy Settings</h3>

    <label><input type="checkbox" id="show_history"> Allow AI to store my responses</label><br><br>

    <button class="modal-btn" onclick="savePrivacy()">Save</button>
    <button class="modal-btn cancel" onclick="closePrivacy()">Cancel</button>
  </div>
</div>
<script>
function showTab(tabId) {

    const allTabs = document.querySelectorAll(".tab-content");

    allTabs.forEach(tab => {
        if (tab.id === tabId) {
            // Show selected tab with animation
            tab.style.display = "block";

            requestAnimationFrame(() => {
                tab.classList.add("active");
            });

        } else {
            // Hide inactive tab smoothly
            tab.classList.remove("active");

            setTimeout(() => {
                tab.style.display = "none";
            }, 250); // matches CSS transition
        }
    });
}
function openSheet(id) {
    const sheet = document.getElementById(id);
    sheet.style.transform = "translateY(0px)";

    document.getElementById("ios-backdrop").classList.add("show");
    sheet.classList.add("show");
}


function closeAllSheets() {
    document.getElementById("ios-backdrop").classList.remove("show");

    document.querySelectorAll(".ios-sheet").forEach(sheet => {
        sheet.style.transform = "translateY(100%)";
        sheet.classList.remove("show");
    });
}


/************************************
 * iOS STYLE DRAG-TO-DISMISS
 ************************************/
let activeSheet = null;
let startY = 0;
let currentY = 0;
let dragging = false;

function enableSheetGestures(sheetId) {
    const sheet = document.getElementById(sheetId);

    sheet.addEventListener("mousedown", startDrag);
    sheet.addEventListener("touchstart", startDrag, {passive:true});

    sheet.addEventListener("mousemove", onDrag);
    sheet.addEventListener("touchmove", onDrag, {passive:false});

    sheet.addEventListener("mouseup", endDrag);
    sheet.addEventListener("mouseleave", endDrag);
    sheet.addEventListener("touchend", endDrag);
}

function startDrag(e) {
    dragging = true;
    activeSheet = e.currentTarget;

    startY = (e.touches ? e.touches[0].clientY : e.clientY);
}

function onDrag(e) {
    if (!dragging || !activeSheet) return;

    let clientY = e.touches ? e.touches[0].clientY : e.clientY;
    currentY = clientY - startY;

    if (currentY > 0) {
        activeSheet.style.transform = `translateY(${currentY}px)`;
    }

    // Prevent page scrolling during gesture
    if (e.touches) e.preventDefault();
}

function endDrag() {
    if (!dragging || !activeSheet) return;

    dragging = false;

    if (currentY > 120) {
        // CLOSE SHEET
        closeAllSheets();
    } else {
        // RESET POSITION
        activeSheet.style.transition = "transform 0.25s ease-out";
        activeSheet.style.transform = "translateY(0px)";
        setTimeout(() => {
            activeSheet.style.transition = "";
        }, 250);
    }

    // Reset values
    currentY = 0;
    activeSheet = null;
}

// Enable drag gestures on all 3 sheets
enableSheetGestures("sheet-password");
enableSheetGestures("sheet-privacy");
enableSheetGestures("sheet-delete");

</script>
<!-- BACKDROP -->
<div id="ios-backdrop" class="ios-backdrop" onclick="closeAllSheets()"></div>

<!-- CHANGE PASSWORD SHEET -->
<div id="sheet-password" class="ios-sheet">
    <h3>Change Password</h3>

    <input type="password" id="old_pass" placeholder="Current Password">
    <input type="password" id="new_pass" placeholder="New Password">
    <input type="password" id="confirm_pass" placeholder="Confirm New Password">

    <button class="sheet-btn blue" onclick="updatePassword()">Update</button>
    <button class="sheet-btn gray" onclick="closeAllSheets()">Cancel</button>
</div>

<!-- PRIVACY SHEET -->
<div id="sheet-privacy" class="ios-sheet">
    <h3>Privacy Settings</h3>

    <label>
        <input type="checkbox" id="show_history"> Allow AI to store my responses
    </label>

    <button class="sheet-btn blue" onclick="savePrivacy()">Save</button>
    <button class="sheet-btn gray" onclick="closeAllSheets()">Cancel</button>
</div>

<!-- DELETE ACCOUNT SHEET -->
<div id="sheet-delete" class="ios-sheet">
    <h3 style="color:#ff3b30;">Delete Account</h3>
    <p>This action cannot be undone.</p>

    <button class="sheet-btn red" onclick="deleteAccount()">Delete Account</button>
    <button class="sheet-btn gray" onclick="closeAllSheets()">Cancel</button>
</div>



</body>
</html>
